<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CommentRequiredRule.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">PMD Java</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.pmd.lang.java.rule.comments</a> &gt; <span class="el_source">CommentRequiredRule.java</span></div><h1>CommentRequiredRule.java</h1><pre class="source lang-java linenums">/**
 * BSD-style license; for more info see http://pmd.sourceforge.net/license.html
 */
package net.sourceforge.pmd.lang.java.rule.comments;

import java.util.Arrays;

import net.sourceforge.pmd.PropertySource;
import net.sourceforge.pmd.lang.java.ast.ASTClassOrInterfaceDeclaration;
import net.sourceforge.pmd.lang.java.ast.ASTCompilationUnit;
import net.sourceforge.pmd.lang.java.ast.ASTConstructorDeclaration;
import net.sourceforge.pmd.lang.java.ast.ASTEnumDeclaration;
import net.sourceforge.pmd.lang.java.ast.ASTFieldDeclaration;
import net.sourceforge.pmd.lang.java.ast.ASTMethodDeclaration;
import net.sourceforge.pmd.lang.java.ast.AbstractJavaAccessNode;
import net.sourceforge.pmd.lang.rule.properties.EnumeratedProperty;

/**
 * @author Brian Remedios
 */
public class CommentRequiredRule extends AbstractCommentRule {

<span class="pc" id="L23">	enum CommentRequirement {</span>
<span class="fc" id="L24">		Required(&quot;Required&quot;), Ignored(&quot;Ignored&quot;), Unwanted(&quot;Unwanted&quot;);</span>

		private final String label;

<span class="fc" id="L28">		CommentRequirement(String theLabel) {</span>
<span class="fc" id="L29">			label = theLabel;</span>
<span class="fc" id="L30">		}</span>

		public static String[] labels() {
<span class="fc" id="L33">			String[] labels = new String[values().length];</span>
<span class="fc" id="L34">			int i = 0;</span>
<span class="fc bfc" id="L35" title="All 2 branches covered.">			for (CommentRequirement requirement : values()) {</span>
<span class="fc" id="L36">				labels[i++] = requirement.label;</span>
			}
<span class="fc" id="L38">			return labels;</span>
		}
	}

<span class="fc" id="L42">	public static final EnumeratedProperty&lt;CommentRequirement&gt; HEADER_CMT_REQUIREMENT_DESCRIPTOR = new EnumeratedProperty&lt;CommentRequirement&gt;(</span>
			&quot;headerCommentRequirement&quot;, &quot;Header comments. Possible values: &quot; + Arrays.toString(CommentRequirement.values()),
			CommentRequirement.labels(), CommentRequirement.values(), 0, 1.0f);

<span class="fc" id="L46">	public static final EnumeratedProperty&lt;CommentRequirement&gt; FIELD_CMT_REQUIREMENT_DESCRIPTOR = new EnumeratedProperty&lt;CommentRequirement&gt;(</span>
			&quot;fieldCommentRequirement&quot;, &quot;Field comments. Possible values: &quot; + Arrays.toString(CommentRequirement.values()),
			CommentRequirement.labels(), CommentRequirement.values(), 0, 2.0f);

<span class="fc" id="L50">	public static final EnumeratedProperty&lt;CommentRequirement&gt; PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR = new EnumeratedProperty&lt;CommentRequirement&gt;(</span>
			&quot;publicMethodCommentRequirement&quot;, &quot;Public method and constructor comments. Possible values: &quot; + Arrays.toString(CommentRequirement.values()),
			CommentRequirement.labels(), CommentRequirement.values(), 0, 3.0f);

<span class="fc" id="L54">	public static final EnumeratedProperty&lt;CommentRequirement&gt; PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR = new EnumeratedProperty&lt;CommentRequirement&gt;(</span>
			&quot;protectedMethodCommentRequirement&quot;, &quot;Protected method constructor comments. Possible values: &quot; + Arrays.toString(CommentRequirement.values()),
			CommentRequirement.labels(), CommentRequirement.values(), 0, 4.0f);

<span class="fc" id="L58">	public static final EnumeratedProperty&lt;CommentRequirement&gt; ENUM_CMT_REQUIREMENT_DESCRIPTOR = new EnumeratedProperty&lt;CommentRequirement&gt;(</span>
			&quot;enumCommentRequirement&quot;, &quot;Enum comments. Possible values: &quot; + Arrays.toString(CommentRequirement.values()),
			CommentRequirement.labels(), CommentRequirement.values(), 0, 5.0f);

<span class="fc" id="L62">	public CommentRequiredRule() {</span>
<span class="fc" id="L63">		definePropertyDescriptor(HEADER_CMT_REQUIREMENT_DESCRIPTOR);</span>
<span class="fc" id="L64">		definePropertyDescriptor(FIELD_CMT_REQUIREMENT_DESCRIPTOR);</span>
<span class="fc" id="L65">		definePropertyDescriptor(PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR);</span>
<span class="fc" id="L66">		definePropertyDescriptor(PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR);</span>
<span class="fc" id="L67">		definePropertyDescriptor(ENUM_CMT_REQUIREMENT_DESCRIPTOR);</span>
<span class="fc" id="L68">	}</span>

	private CommentRequirement getCommentRequirement(String label) {
<span class="fc bfc" id="L71" title="All 2 branches covered.">		if (CommentRequirement.Ignored.label.equals(label)) {</span>
<span class="fc" id="L72">			return CommentRequirement.Ignored;</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">		} else if (CommentRequirement.Required.label.equals(label)) {</span>
<span class="fc" id="L74">			return CommentRequirement.Required;</span>
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">		} else if (CommentRequirement.Unwanted.label.equals(label)) {</span>
<span class="fc" id="L76">			return CommentRequirement.Unwanted;</span>
		} else {
<span class="nc" id="L78">			return null;</span>
		}
	}

	@Override
	public Object visit(ASTClassOrInterfaceDeclaration decl, Object data) {
<span class="fc" id="L84">		CommentRequirement headerRequirement = getCommentRequirement(getProperty(</span>
				HEADER_CMT_REQUIREMENT_DESCRIPTOR).toString());

<span class="pc bpc" id="L87" title="1 of 2 branches missed.">		if (headerRequirement != CommentRequirement.Ignored) {</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">			if (headerRequirement == CommentRequirement.Required) {</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">				if (decl.comment() == null) {</span>
<span class="fc" id="L90">					addViolationWithMessage(data, decl,</span>
							HEADER_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Required,
							decl.getBeginLine(), decl.getEndLine());
				}
			} else {
<span class="pc bpc" id="L96" title="1 of 2 branches missed.">				if (decl.comment() != null) {</span>
<span class="fc" id="L97">					addViolationWithMessage(data, decl,</span>
							HEADER_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Unwanted,
							decl.getBeginLine(), decl.getEndLine());
				}
			}
		}

<span class="fc" id="L105">		return super.visit(decl, data);</span>
	}

	@Override
	public Object visit(ASTConstructorDeclaration decl, Object data) {
<span class="fc" id="L110">	    checkComment(decl, data);</span>
<span class="fc" id="L111">	    return super.visit(decl, data);</span>
	}

	@Override
	public Object visit(ASTMethodDeclaration decl, Object data) {
<span class="fc" id="L116">	    checkComment(decl, data);</span>
<span class="fc" id="L117">	    return super.visit(decl, data);</span>
	}

	private void checkComment(AbstractJavaAccessNode decl, Object data) {
<span class="fc" id="L121">		CommentRequirement pubMethodRequirement = getCommentRequirement(getProperty(</span>
				PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR).toString());
<span class="fc" id="L123">		CommentRequirement protMethodRequirement = getCommentRequirement(getProperty(</span>
				PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR).toString());

<span class="fc bfc" id="L126" title="All 2 branches covered.">		if (decl.isPublic()) {</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">			if (pubMethodRequirement != CommentRequirement.Ignored) {</span>
<span class="fc bfc" id="L128" title="All 2 branches covered.">				if (pubMethodRequirement == CommentRequirement.Required) {</span>
<span class="fc bfc" id="L129" title="All 2 branches covered.">					if (decl.comment() == null) {</span>
<span class="fc" id="L130">						addViolationWithMessage(data, decl,</span>
								PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR.name()
										+ &quot; &quot; + CommentRequirement.Required,
								decl.getBeginLine(), decl.getEndLine());
					}
				} else {
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">					if (decl.comment() != null) {</span>
<span class="fc" id="L137">						addViolationWithMessage(data, decl,</span>
								PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR.name()
										+ &quot; &quot; + CommentRequirement.Unwanted,
								decl.getBeginLine(), decl.getEndLine());
					}
				}
			}
<span class="fc bfc" id="L144" title="All 2 branches covered.">		} else if (decl.isProtected()) {</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">			if (protMethodRequirement != CommentRequirement.Ignored) {</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">				if (protMethodRequirement == CommentRequirement.Required) {</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">					if (decl.comment() == null) {</span>
<span class="fc" id="L148">						addViolationWithMessage(data, decl,</span>
								PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR.name()
										+ &quot; &quot; + CommentRequirement.Required,
								decl.getBeginLine(), decl.getEndLine());
					}
				} else {
<span class="nc bnc" id="L154" title="All 2 branches missed.">					if (decl.comment() != null) {</span>
<span class="nc" id="L155">						addViolationWithMessage(data, decl,</span>
								PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR.name()
										+ &quot; &quot; + CommentRequirement.Unwanted,
								decl.getBeginLine(), decl.getEndLine());
					}
				}
			}
		}
<span class="fc" id="L163">	}</span>

	@Override
	public Object visit(ASTFieldDeclaration decl, Object data) {
<span class="fc" id="L167">		CommentRequirement fieldRequirement = getCommentRequirement(getProperty(</span>
				FIELD_CMT_REQUIREMENT_DESCRIPTOR).toString());

<span class="fc bfc" id="L170" title="All 2 branches covered.">		if (fieldRequirement != CommentRequirement.Ignored) {</span>
<span class="fc bfc" id="L171" title="All 2 branches covered.">			if (fieldRequirement == CommentRequirement.Required) {</span>
<span class="fc bfc" id="L172" title="All 2 branches covered.">				if (decl.comment() == null) {</span>
<span class="fc" id="L173">					addViolationWithMessage(data, decl,</span>
							FIELD_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Required,
							decl.getBeginLine(), decl.getEndLine());
				}
			} else {
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">				if (decl.comment() != null) {</span>
<span class="fc" id="L180">					addViolationWithMessage(data, decl,</span>
							FIELD_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Unwanted,
							decl.getBeginLine(), decl.getEndLine());
				}
			}
		}

<span class="fc" id="L188">		return super.visit(decl, data);</span>
	}

	@Override
	public Object visit(ASTEnumDeclaration decl, Object data) {
		
<span class="fc" id="L194">		CommentRequirement enumRequirement = getCommentRequirement(getProperty(</span>
				ENUM_CMT_REQUIREMENT_DESCRIPTOR).toString());

<span class="fc bfc" id="L197" title="All 2 branches covered.">		if (enumRequirement != CommentRequirement.Ignored) {</span>
<span class="fc bfc" id="L198" title="All 2 branches covered.">			if (enumRequirement == CommentRequirement.Required) {</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">				if (decl.comment() == null) {</span>
<span class="fc" id="L200">					addViolationWithMessage(data, decl,</span>
							ENUM_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Required,
							decl.getBeginLine(), decl.getEndLine());
				}
			} else {
<span class="pc bpc" id="L206" title="1 of 2 branches missed.">				if (decl.comment() != null) {</span>
<span class="fc" id="L207">					addViolationWithMessage(data, decl,</span>
							ENUM_CMT_REQUIREMENT_DESCRIPTOR.name() + &quot; &quot;
									+ CommentRequirement.Unwanted,
							decl.getBeginLine(), decl.getEndLine());
				}
			}
		}

<span class="fc" id="L215">		return super.visit(decl, data);</span>
	}

	@Override
	public Object visit(ASTCompilationUnit cUnit, Object data) {
<span class="fc" id="L220">		assignCommentsToDeclarations(cUnit);</span>

<span class="fc" id="L222">		return super.visit(cUnit, data);</span>
	}

	public boolean allCommentsAreIgnored() {

<span class="pc bpc" id="L227" title="7 of 8 branches missed.">		return getProperty(HEADER_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored</span>
				&amp;&amp; getProperty(FIELD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
				&amp;&amp; getProperty(PUB_METHOD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored
				&amp;&amp; getProperty(PROT_METHOD_CMT_REQUIREMENT_DESCRIPTOR) == CommentRequirement.Ignored;
	}

	/**
	 * @see PropertySource#dysfunctionReason()
	 */
	@Override
	public String dysfunctionReason() {
<span class="pc bpc" id="L238" title="1 of 2 branches missed.">		return allCommentsAreIgnored() ? &quot;All comment types are ignored&quot; : null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>